<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script>
    function sendForm(formId) {
      document.getElementById(formId).submit();
    }
  </script>

  <title>Catalog page</title>
</head>
<body>
<div class="container">
  <div th:insert="adminHeader"></div>
  <div class="row mx-3 pt-4 gx-5">
    <div class="col-9">
      <div class="row">
        <div class="col fs-5">
          allProducts
        </div>
        <div class="col-md-auto">
          <form id="sortForm" action="${pageContext.request.contextPath}/main/catalog">
            <label for="sortSelect" class="fs-5">sortBy</label>
            <select name="options" id="sortSelect" onchange="sendForm('sortForm')">
              <option id="option1" th:if="${session.get('sortOption') == 'byNameAZ'}" th:attr="selected"
                      value="byNameAZ">byNameAZ
              </option>
              <option id="option2" th:if="${session.get('sortOption') == 'byNameZA'}" th:attr="selected"
                      value="byNameZA">byNameZA
              </option>
              <option id="option3" th:if="${session.get('sortOption') == 'priceHighLow'}"
                      th:attr="selected"
                      value="priceHighLow">byPriceHL
              </option>
              <option id="option4" th:if="${session.get('sortOption') == 'priceLowHigh'}"
                      th:attr="selected"
                      value="priceLowHigh">byPriceLH
              </option>
              <option id="option5" th:if="${session.get('sortOption') == 'newest'}" th:attr="selected"
                      value="newest">byNewest
              </option>
            </select>
          </form>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <table class="table">
            <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">productName</th>
              <th scope="col">price</th>
              <th scope="col">creationDate</th>
              <th scope="col">properties</th>
              <th scope="col"></th>
              <th scope="col"></th>
              <th scope="col"></th>
            </tr>
            </thead>
            <tbody>

            <div th:each="product, iStat : ${productPage}">
              <tr>
                <th scope="row" th:text="${pageSize * (currentPage - 1) + iStat.index + 1}"></th>
                <td th:text="${product.productName}"/>
                <td th:text="${product.price}"/>
                <td th:text="${product.creationDate}"/>
                <td>
                  <div th:each="property : ${product.properties}">
                    <p th:text="${property.propertyName + ':' + property.propertyValue}"></p>
                  </div>
                </td>
                <td>
                  <form th:action="@{/admin/management/cart/add/{productId}(productId=${product.id})}" method="post">
                    <button class="btn btn-outline-dark btn-sm">
                      addToCart
                    </button>
                  </form>
                </td>
                <td>
                  <form th:action="@{/admin/product/edit/{productId}(productId=${product.id})}" method="get">
                    <button class="btn btn-outline-dark btn-sm">
                      edit
                    </button>
                  </form>
                </td>
                <td>
                  <form th:action="@{/admin/delete/{productId}(productId=${product.id})}" method="post">
                    <button class="btn btn-outline-dark btn-sm">
                      delete
                    </button>
                  </form>
                </td>
              </tr>
            </div>
            </tbody>
          </table>

          <div class="row">
            <div class="col-md-auto">
              <nav aria-label="Page navigation">
                <ul class="pagination">
                  <div th:if="${currentPage != 1}">
                    <li>
                      <a class="page-link"
                         th:href="@{/admin/catalog(page=${currentPage - 1})}">previous</a>
                    </li>
                  </div>

                  <div th:if="${productPage.totalPages > 0}"
                       th:each="pageNumber : ${pageNumbers}">
                    <div th:if="${pageNumber == currentPage}">
                      <li class="page-item active">
                        <a th:text="${pageNumber}"
                           class="page-link" aria-disabled="true"></a>
                      </li>
                    </div>
                    <div th:unless="${pageNumber == currentPage}">
                      <li>
                        <a th:href="@{/admin/catalog(page=${pageNumber})}"
                           th:text="${pageNumber}"
                           class="page-link"></a>
                      </li>

                    </div>
                  </div>
                  <div th:if="${currentPage < productPage.totalPages}">
                    <li>
                      <a class="page-link"
                         th:href="@{/admin/catalog(page=${currentPage + 1})}">next</a>
                    </li>
                  </div>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-3">
      <div class="row">
        <div class="col fs-5">
          Properties:
        </div>
      </div>
      <div class="row pt-5">
        <div class="col mt-3" style="height: 600px; overflow-y: scroll;">
          <form id="formProperties" th:action="@{/admin/catalog}">
            <input type="hidden" name="action" value="selectByProperties">
            <!--            <c:set var="j" value="${1}"/>-->
            <!--            <c:forEach items="${sessionScope.productProperties}" var="property">-->
            <!--              <fieldset>-->
            <!--                <legend class="fs-5">${property.key}:</legend>-->
            <!--                <c:forEach items="${property.value}" var="value">-->
            <!--                  <input class="form-check-input" type="checkbox" id="${j}" name="${property.key}"-->
            <!--                         value="${value}"/>-->
            <!--                  <label for="${j}">${value}</label>-->
            <!--                </c:forEach>-->
            <!--              </fieldset>-->
            <!--              <br>-->
            <!--            </c:forEach>-->
            <!--            <c:set var="j" value="${j+1}"/>-->
            <!--            <div class="row">-->
            <!--              <div class="col gx-1">-->
            <!--                <label for="priceFrom" class="form-label"><fmt:message key="localPriceFrom"/></label>-->
            <!--                <input type="number" name="priceFrom" class="form-control" id="priceFrom" min="0"-->
            <!--                       placeholder="<fmt:message key="localPriceFrom"/>">-->
            <!--              </div>-->
            <!--              <div class="col">-->
            <!--                <label for="priceTo" class="form-label"><fmt:message key="localPriceTo"/></label>-->
            <!--                <input type="number" name="priceTo" class="form-control" id="priceTo" min="0"-->
            <!--                       placeholder="<fmt:message key="localPriceTo"/>">-->
            <!--              </div>-->
            <!--            </div>-->
          </form>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-md-auto fs-6 pt-5">
          <button form="formProperties" class="btn btn-outline-dark">
            submitSelect
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>